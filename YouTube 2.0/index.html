<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube 2.0 ‚Äî –ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω Youtube-Dregot, –∑–∞—è–≤–∫–∏ –Ω–∞ –∞–¥–º–∏–Ω–∞</title>
    <style>
        /* ========== –°–¢–ò–õ–ò (–ü–û–õ–ù–´–ô –ù–ê–ë–û–†) ========== */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background-color: #0f0f0f;
            color: #fff;
            margin: 0;
            padding: 0;
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }
        .app {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(0,0,0,0.7);
            min-height: 100vh;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: rgba(15,15,15,0.95);
            border-bottom: 1px solid #303030;
            margin-bottom: 30px;
            border-radius: 8px;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .logo img {
            height: 40px;
            width: auto;
            object-fit: contain;
        }
        .logo span {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff0000;
        }
        .user-section {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            background-color: #3ea6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            text-transform: uppercase;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            background-color: #272727;
            color: white;
        }
        .btn:hover { background-color: #3f3f3f; }
        .btn-primary {
            background-color: #3ea6ff;
            color: #0f0f0f;
        }
        .btn-primary:hover { background-color: #65b8ff; }
        .btn-success {
            background-color: #2e7d32;
            color: white;
        }
        .btn-success:hover { background-color: #388e3c; }
        .btn-danger {
            background-color: #d32f2f;
        }
        .btn-danger:hover { background-color: #f44336; }
        .btn-warning {
            background-color: #ffb300;
            color: #0f0f0f;
        }
        .btn-warning:hover { background-color: #ffc107; }
        .btn-small {
            padding: 4px 12px;
            font-size: 0.8rem;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }
        .card {
            background-color: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s, border-color 0.2s;
            cursor: pointer;
            border: 1px solid #303030;
            position: relative;
        }
        .card:hover {
            transform: scale(1.02);
            border-color: #3ea6ff;
        }
        .thumbnail {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
            background-color: #2a2a2a;
        }
        .video-info {
            padding: 12px;
        }
        .video-title {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 6px;
            color: #fff;
        }
        .video-meta {
            color: #aaa;
            font-size: 0.9rem;
        }
        .form-container {
            max-width: 500px;
            margin: 0 auto;
            background-color: #1e1e1e;
            padding: 30px;
            border-radius: 12px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ddd;
        }
        .form-control {
            width: 100%;
            padding: 12px;
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
        }
        .form-control:focus {
            outline: none;
            border-color: #3ea6ff;
        }
        .video-player-container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }
        video {
            width: 100%;
            border-radius: 12px;
            background-color: black;
        }
        .video-details {
            margin-top: 20px;
        }
        .video-actions {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .like-btn, .dislike-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            background-color: #272727;
            cursor: pointer;
            transition: all 0.2s;
        }
        .like-btn.active {
            background-color: #3ea6ff;
            color: black;
        }
        .dislike-btn.active {
            background-color: #d32f2f;
        }
        .subscribe-btn {
            padding: 8px 16px;
            border-radius: 20px;
            background-color: #cc0000;
            color: white;
            border: none;
            cursor: pointer;
        }
        .subscribe-btn.subscribed {
            background-color: #272727;
        }
        .admin-badge {
            background-color: #ffb300;
            color: #000;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        .super-admin-badge {
            background-color: #ffd700;
            color: #000;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
            box-shadow: 0 0 10px rgba(255,215,0,0.5);
        }
        .admin-controls {
            margin-top: 10px;
            padding: 0 12px 12px 12px;
            display: flex;
            gap: 10px;
        }

        /* ========== –í–ö–õ–ê–î–ö–ò ========== */
        .tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: 1px solid #303030;
            padding-bottom: 10px;
        }
        .tab {
            padding: 8px 20px;
            border-radius: 20px;
            background-color: transparent;
            color: #aaa;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        .tab:hover {
            background-color: #272727;
            color: #fff;
        }
        .tab.active {
            background-color: #3ea6ff;
            color: #0f0f0f;
        }

        /* ========== –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò ========== */
        .comments-section {
            margin-top: 40px;
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
        }
        .comment {
            padding: 15px 0;
            border-bottom: 1px solid #303030;
        }
        .comment:last-child {
            border-bottom: none;
        }
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .comment-author {
            color: #3ea6ff;
            font-weight: 500;
        }
        .comment-date {
            color: #aaa;
            font-size: 0.8rem;
        }
        .comment-text {
            color: #fff;
            line-height: 1.4;
        }
        .comment-actions {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        /* ========== –ù–ê–°–¢–†–û–ô–ö–ò –ö–ê–ù–ê–õ–ê ========== */
        .channel-stats {
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #303030;
        }
        .stat-item:last-child {
            border-bottom: none;
        }
        .stat-label {
            color: #aaa;
        }
        .stat-value {
            color: #fff;
            font-weight: 500;
        }
        .avatar-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            background-color: #3ea6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            text-transform: uppercase;
        }

        /* ========== –ü–û–ò–°–ö YouTube ========== */
        .youtube-search {
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .youtube-player {
            width: 100%;
            aspect-ratio: 16/9;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 12px;
        }

        /* ========== –ó–ê–Ø–í–ö–ò –ù–ê –ê–î–ú–ò–ù–ê ========== */
        .applications-container {
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }
        .application-card {
            background-color: #2a2a2a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .application-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .application-user {
            color: #3ea6ff;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .application-date {
            color: #aaa;
            font-size: 0.9rem;
        }
        .application-info {
            margin-bottom: 15px;
        }
        .application-reason {
            background-color: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            color: #ddd;
            font-style: italic;
        }
        .application-actions {
            display: flex;
            gap: 15px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="app" id="app"></div>

    <script>
        // ============================================
        // YOUTUBE 2.0 ‚Äî –§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø
        // –ì–õ–ê–í–ù–´–ô –ê–î–ú–ò–ù: Youtube-Dregot
        // –ó–ê–Ø–í–ö–ò –ù–ê –ê–î–ú–ò–ù–ê, SUPERADMIN, TXT –¢–û–õ–¨–ö–û –î–õ–Ø –ù–ï–ì–û
        // ============================================

        // ---------- 1. –ù–ê–°–¢–†–û–ô–ö–ò –•–†–ê–ù–ò–õ–ò–© ----------
        const STORAGE_KEYS = {
            USERS: 'yt2_users',
            CURRENT_USER: 'yt2_currentUser',
            YT_API_KEY: 'yt2_apikey'
        };

        function safeParse(key, defaultValue) {
            try {
                const item = localStorage.getItem(key);
                if (item === null) return defaultValue;
                return JSON.parse(item);
            } catch (e) {
                console.warn(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ ${key}, –æ—á–∏—â–∞—é...`, e);
                localStorage.removeItem(key);
                return defaultValue;
            }
        }

        let users = safeParse(STORAGE_KEYS.USERS, []);
        let currentUser = safeParse(STORAGE_KEYS.CURRENT_USER, null);
        let youtubeApiKey = localStorage.getItem(STORAGE_KEYS.YT_API_KEY) || 'AIzaSyB_9vVoykH5Ae04bqE_QaANew4Z8YQe1ik';

        function saveUsers() { localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users)); }
        function saveCurrentUser() { localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser)); }
        function saveYoutubeApiKey(key) {
            youtubeApiKey = key;
            localStorage.setItem(STORAGE_KEYS.YT_API_KEY, key);
        }

        // ---------- 2. INDEXEDDB –î–õ–Ø –í–ò–î–ï–û, –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í, –ê–í–ê–¢–ê–†–û–í, –ó–ê–Ø–í–û–ö ----------
        const DB_NAME = 'YouTubeDB';
        const DB_VERSION = 4; // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏—é –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∑–∞—è–≤–æ–∫
        const VIDEO_STORE = 'videos';
        const COMMENT_STORE = 'comments';
        const AVATAR_STORE = 'avatars';
        const APPLICATION_STORE = 'admin_applications'; // –Ω–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

        let db = null;
        let dbPromise = null;

        function openDB() {
            if (dbPromise) return dbPromise;
            dbPromise = new Promise((resolve, reject) => {
                if (db) {
                    resolve(db);
                    return;
                }
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // –í–∏–¥–µ–æ
                    if (!db.objectStoreNames.contains(VIDEO_STORE)) {
                        const store = db.createObjectStore(VIDEO_STORE, { keyPath: 'id' });
                        store.createIndex('authorId', 'authorId', { unique: false });
                    }
                    
                    // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                    if (!db.objectStoreNames.contains(COMMENT_STORE)) {
                        const store = db.createObjectStore(COMMENT_STORE, { keyPath: 'id' });
                        store.createIndex('videoId', 'videoId', { unique: false });
                        store.createIndex('authorId', 'authorId', { unique: false });
                    }
                    
                    // –ê–≤–∞—Ç–∞—Ä—ã
                    if (!db.objectStoreNames.contains(AVATAR_STORE)) {
                        db.createObjectStore(AVATAR_STORE, { keyPath: 'userId' });
                    }
                    
                    // –ó–∞—è–≤–∫–∏ –Ω–∞ –∞–¥–º–∏–Ω–∞
                    if (!db.objectStoreNames.contains(APPLICATION_STORE)) {
                        const store = db.createObjectStore(APPLICATION_STORE, { keyPath: 'id' });
                        store.createIndex('username', 'username', { unique: false });
                        store.createIndex('status', 'status', { unique: false });
                        store.createIndex('timestamp', 'timestamp', { unique: false });
                    }
                };
            });
            return dbPromise;
        }

        // ---------- –í–ò–î–ï–û: –†–ê–ë–û–¢–ê –° –ë–ê–ó–û–ô ----------
        async function saveVideoToDB(videoData) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(VIDEO_STORE, 'readwrite');
                const store = tx.objectStore(VIDEO_STORE);
                const request = store.put(videoData);
                request.onsuccess = () => resolve(videoData.id);
                request.onerror = () => reject(request.error);
            });
        }

        async function getAllVideosFromDB() {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(VIDEO_STORE, 'readonly');
                const store = tx.objectStore(VIDEO_STORE);
                const request = store.getAll();
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function getVideoFromDB(videoId) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(VIDEO_STORE, 'readonly');
                const store = tx.objectStore(VIDEO_STORE);
                const request = store.get(videoId);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function deleteVideoFromDB(videoId) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(VIDEO_STORE, 'readwrite');
                const store = tx.objectStore(VIDEO_STORE);
                const request = store.delete(videoId);
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        async function updateVideoInDB(videoId, updates) {
            const video = await getVideoFromDB(videoId);
            if (!video) return;
            Object.assign(video, updates);
            await saveVideoToDB(video);
        }

        // ---------- –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò: –†–ê–ë–û–¢–ê –° –ë–ê–ó–û–ô ----------
        async function saveCommentToDB(commentData) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(COMMENT_STORE, 'readwrite');
                const store = tx.objectStore(COMMENT_STORE);
                const request = store.put(commentData);
                request.onsuccess = () => resolve(commentData.id);
                request.onerror = () => reject(request.error);
            });
        }

        async function getCommentsByVideo(videoId) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(COMMENT_STORE, 'readonly');
                const store = tx.objectStore(COMMENT_STORE);
                const index = store.index('videoId');
                const request = index.getAll(videoId);
                request.onsuccess = () => {
                    const comments = request.result;
                    comments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    resolve(comments);
                };
                request.onerror = () => reject(request.error);
            });
        }

        async function deleteCommentFromDB(commentId) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(COMMENT_STORE, 'readwrite');
                const store = tx.objectStore(COMMENT_STORE);
                const request = store.delete(commentId);
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        async function deleteCommentsByVideo(videoId) {
            const comments = await getCommentsByVideo(videoId);
            for (const comment of comments) {
                await deleteCommentFromDB(comment.id);
            }
        }

        // ---------- –ê–í–ê–¢–ê–†–´: –†–ê–ë–û–¢–ê –° –ë–ê–ó–û–ô ----------
        async function saveAvatarToDB(userId, avatarData) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(AVATAR_STORE, 'readwrite');
                const store = tx.objectStore(AVATAR_STORE);
                const request = store.put({ userId, avatarData });
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        async function getAvatarFromDB(userId) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(AVATAR_STORE, 'readonly');
                const store = tx.objectStore(AVATAR_STORE);
                const request = store.get(userId);
                request.onsuccess = () => resolve(request.result?.avatarData || null);
                request.onerror = () => reject(request.error);
            });
        }

        async function deleteAvatarFromDB(userId) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(AVATAR_STORE, 'readwrite');
                const store = tx.objectStore(AVATAR_STORE);
                const request = store.delete(userId);
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        // ---------- –ó–ê–Ø–í–ö–ò –ù–ê –ê–î–ú–ò–ù–ê: –†–ê–ë–û–¢–ê –° –ë–ê–ó–û–ô ----------
        async function saveApplicationToDB(applicationData) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(APPLICATION_STORE, 'readwrite');
                const store = tx.objectStore(APPLICATION_STORE);
                const request = store.put(applicationData);
                request.onsuccess = () => resolve(applicationData.id);
                request.onerror = () => reject(request.error);
            });
        }

        async function getApplicationsByStatus(status) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(APPLICATION_STORE, 'readonly');
                const store = tx.objectStore(APPLICATION_STORE);
                const index = store.index('status');
                const request = index.getAll(status);
                request.onsuccess = () => {
                    const applications = request.result;
                    applications.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    resolve(applications);
                };
                request.onerror = () => reject(request.error);
            });
        }

        async function getAllApplications() {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(APPLICATION_STORE, 'readonly');
                const store = tx.objectStore(APPLICATION_STORE);
                const request = store.getAll();
                request.onsuccess = () => {
                    const applications = request.result;
                    applications.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    resolve(applications);
                };
                request.onerror = () => reject(request.error);
            });
        }

        async function getApplicationById(applicationId) {
            const database = await openDB();
            return new Promise((resolve, reject) => {
                const tx = database.transaction(APPLICATION_STORE, 'readonly');
                const store = tx.objectStore(APPLICATION_STORE);
                const request = store.get(applicationId);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function updateApplicationStatus(applicationId, status) {
            const database = await openDB();
            const tx = database.transaction(APPLICATION_STORE, 'readwrite');
            const store = tx.objectStore(APPLICATION_STORE);
            const application = await getApplicationById(applicationId);
            if (application) {
                application.status = status;
                application.processedAt = new Date().toISOString();
                application.processedBy = currentUser?.id || null;
                const request = store.put(application);
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            }
        }

        // ---------- 3. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ----------
        function generateId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // ---------- 4. –†–ê–ë–û–¢–ê –° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò ----------
        function findUserByUsername(username) {
            return users.find(u => u.username.toLowerCase() === username.toLowerCase());
        }

        function registerUser(username, password) {
            if (findUserByUsername(username)) {
                return { success: false, error: '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ' };
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–ª–∞–≤–Ω—ã–º –∞–¥–º–∏–Ω–æ–º
            const isSuperAdmin = username === 'Youtube-Dregot';
            
            const newUser = {
                id: generateId(),
                username,
                password,
                subscriptions: [],
                likedVideos: [],
                dislikedVideos: [],
                registered: new Date().toISOString(),
                isAdmin: isSuperAdmin, // –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞ isAdmin = true
                isSuperAdmin: isSuperAdmin // —Ñ–ª–∞–≥ –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞
            };
            users.push(newUser);
            saveUsers();

            // –¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç .txt —Ñ–∞–π–ª
            if (isSuperAdmin) {
                const userData = `Username: ${username}\nPassword: ${password}\nID: ${newUser.id}\nRegistered: ${newUser.registered}\nSuperAdmin: –î–∞ (–≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)`;
                const blob = new Blob([userData], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${username}_SUPERADMIN_data.txt`;
                a.click();
                URL.revokeObjectURL(url);
            }

            return { success: true, user: newUser };
        }

        function loginUser(username, password) {
            const user = findUserByUsername(username);
            if (!user || user.password !== password) {
                return { success: false, error: '–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å' };
            }
            currentUser = user;
            saveCurrentUser();
            return { success: true, user };
        }

        function logout() {
            currentUser = null;
            saveCurrentUser();
            renderHome();
        }

        // ---------- –ü–û–õ–£–ß–ï–ù–ò–ï –ê–í–ê–¢–ê–†–ê (–ò–ó –ö–≠–®–ê –ò–õ–ò –ë–î) ----------
        const avatarCache = new Map();

        async function getUserAvatar(userId) {
            if (avatarCache.has(userId)) {
                return avatarCache.get(userId);
            }
            const avatar = await getAvatarFromDB(userId);
            avatarCache.set(userId, avatar);
            return avatar;
        }

        async function setUserAvatar(userId, avatarData) {
            await saveAvatarToDB(userId, avatarData);
            avatarCache.set(userId, avatarData);
        }

        // ---------- 5. –ü–†–û–í–ï–†–ö–ê –í–û–ó–†–ê–°–¢–ê –ê–ö–ö–ê–£–ù–¢–ê –ò –õ–ò–ú–ò–¢–´ ----------
        function getAccountAgeInDays(user) {
            if (!user) return 0;
            const registered = new Date(user.registered);
            const now = new Date();
            const diff = now - registered;
            return diff / (1000 * 60 * 60 * 24);
        }

        function getMaxUploadSizeForUser(user) {
            if (!user) return 0;
            // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (–≤–∫–ª—é—á–∞—è –≥–ª–∞–≤–Ω–æ–≥–æ) –≤—Å–µ–≥–¥–∞ 20 –ì–ë
            if (user.isAdmin) {
                return 20 * 1024; // 20 –ì–ë –≤ –ú–ë
            }
            const ageDays = getAccountAgeInDays(user);
            if (ageDays >= 7) {
                return 10 * 1024; // 10 –ì–ë –≤ –ú–ë
            } else {
                return 1 * 1024; // 1 –ì–ë –≤ –ú–ë
            }
        }

        // ---------- 6. –†–ê–ë–û–¢–ê –° –í–ò–î–ï–û (–ß–ï–†–ï–ó INDEXEDDB) ----------
        let videosCache = [];

        async function loadVideosCache() {
            try {
                videosCache = await getAllVideosFromDB();
                videosCache.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ –∏–∑ IndexedDB', e);
                videosCache = [];
            }
        }

        async function addVideo(title, videoFile, thumbnailFile) {
            if (!currentUser) return null;

            const maxSizeMB = getMaxUploadSizeForUser(currentUser);
            const videoSizeMB = videoFile.size / (1024 * 1024);
            if (videoSizeMB > maxSizeMB) {
                alert(`‚ùå –í–∏–¥–µ–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ (${videoSizeMB.toFixed(1)} –ú–ë).\n–ú–∞–∫—Å–∏–º—É–º –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞: ${maxSizeMB} –ú–ë.`);
                return null;
            }

            try {
                const videoData = await readFileAsDataURL(videoFile);
                const thumbnailData = await readFileAsDataURL(thumbnailFile);

                const newVideo = {
                    id: generateId(),
                    title,
                    authorId: currentUser.id,
                    authorName: currentUser.username,
                    videoData,
                    thumbnailData,
                    likes: [],
                    dislikes: [],
                    views: [],
                    timestamp: new Date().toISOString()
                };

                await saveVideoToDB(newVideo);
                await loadVideosCache();
                return newVideo;
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∏–¥–µ–æ –≤ IndexedDB', err);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤–∏–¥–µ–æ. –í–æ–∑–º–æ–∂–Ω–æ, —Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞.');
                return null;
            }
        }

        function getVideoById(videoId) {
            return videosCache.find(v => v.id === videoId);
        }

        async function deleteVideo(videoId) {
            await deleteCommentsByVideo(videoId);
            await deleteVideoFromDB(videoId);
            await loadVideosCache();
        }

        async function updateVideoTitle(videoId, newTitle) {
            await updateVideoInDB(videoId, { title: newTitle });
            await loadVideosCache();
        }

        // ---------- –õ–ê–ô–ö–ò / –î–ò–ó–õ–ê–ô–ö–ò ----------
        async function toggleLike(videoId, userId) {
            const video = await getVideoFromDB(videoId);
            if (!video || !userId) return false;
            if (video.likes.includes(userId)) {
                video.likes = video.likes.filter(id => id !== userId);
            } else {
                video.dislikes = video.dislikes.filter(id => id !== userId);
                video.likes.push(userId);
            }
            await saveVideoToDB(video);
            await loadVideosCache();
            return true;
        }

        async function toggleDislike(videoId, userId) {
            const video = await getVideoFromDB(videoId);
            if (!video || !userId) return false;
            if (video.dislikes.includes(userId)) {
                video.dislikes = video.dislikes.filter(id => id !== userId);
            } else {
                video.likes = video.likes.filter(id => id !== userId);
                video.dislikes.push(userId);
            }
            await saveVideoToDB(video);
            await loadVideosCache();
            return true;
        }

        // ---------- –ü–†–û–°–ú–û–¢–†–´ ----------
        async function addView(videoId, userId) {
            const video = await getVideoFromDB(videoId);
            if (!video) return;
            if (userId && !video.views.includes(userId)) {
                video.views.push(userId);
            } else if (!userId) {
                video.views.push('guest_' + Date.now());
            }
            await saveVideoToDB(video);
            await loadVideosCache();
        }

        // ---------- –ü–û–î–ü–ò–°–ö–ò ----------
        function toggleSubscription(authorId, userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return false;
            if (user.subscriptions.includes(authorId)) {
                user.subscriptions = user.subscriptions.filter(id => id !== authorId);
            } else {
                user.subscriptions.push(authorId);
            }
            saveUsers();
            if (currentUser && currentUser.id === userId) {
                currentUser = user;
                saveCurrentUser();
            }
            return true;
        }

        function isSubscribed(authorId, userId) {
            const user = users.find(u => u.id === userId);
            return user ? user.subscriptions.includes(authorId) : false;
        }

        // ---------- –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò ----------
        async function addComment(videoId, text) {
            if (!currentUser) {
                alert('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
                return null;
            }
            const comment = {
                id: generateId(),
                videoId,
                authorId: currentUser.id,
                authorName: currentUser.username,
                text: text.trim(),
                timestamp: new Date().toISOString()
            };
            await saveCommentToDB(comment);
            return comment;
        }

        async function deleteComment(commentId, userId, isAdmin) {
            const database = await openDB();
            const comment = await new Promise((resolve, reject) => {
                const tx = database.transaction(COMMENT_STORE, 'readonly');
                const store = tx.objectStore(COMMENT_STORE);
                const request = store.get(commentId);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
            if (!comment) return false;
            if (comment.authorId === userId || isAdmin) {
                await deleteCommentFromDB(commentId);
                return true;
            }
            return false;
        }

        // ---------- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ö–ê–ù–ê–õ–ê ----------
        async function getChannelStats(userId) {
            const subscribers = users.filter(u => u.subscriptions.includes(userId)).length;
            const userVideos = videosCache.filter(v => v.authorId === userId);
            const totalViews = userVideos.reduce((sum, v) => sum + v.views.length, 0);
            const totalLikes = userVideos.reduce((sum, v) => sum + v.likes.length, 0);
            const totalDislikes = userVideos.reduce((sum, v) => sum + v.dislikes.length, 0);
            const videosCount = userVideos.length;
            return { subscribers, totalViews, totalLikes, totalDislikes, videosCount };
        }

        // ---------- 7. –ü–†–û–í–ï–†–ö–ê –í–õ–ê–î–ï–õ–¨–¶–ê (–¢–û–õ–¨–ö–û –î–õ–Ø –û–ë–´–ß–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô) ----------
        function verifyOwner(birthDate, password) {
            const REQUIRED_BIRTH = "02.02.2017";
            const REQUIRED_PASS = "H3NGbaSh7VMq";
            return (birthDate === REQUIRED_BIRTH && password === REQUIRED_PASS);
        }

        // ---------- 8. –ò–ú–ü–û–†–¢ –ò–ó –ü–ê–ü–ö–ò VIDEO ----------
        async function importFromVideoFolder() {
            if (!currentUser) {
                alert('‚ùå –î–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤–∏–¥–µ–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.');
                renderLogin();
                return;
            }

            const input = document.createElement('input');
            input.type = 'file';
            input.webkitdirectory = true;
            input.accept = 'video/mp4,image/*';

            input.onchange = async (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) {
                    alert('–ü–∞–ø–∫–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª–æ–≤.');
                    return;
                }

                const folders = {};
                files.forEach(file => {
                    const path = file.webkitRelativePath;
                    const parts = path.split('/');
                    const folderName = parts[0];
                    if (!folders[folderName]) folders[folderName] = [];
                    folders[folderName].push(file);
                });

                const folderNames = Object.keys(folders);
                alert(`üìÅ –ù–∞–π–¥–µ–Ω–æ –ø–∞–ø–æ–∫: ${folderNames.length}. –ù–∞—á–∏–Ω–∞—é –∏–º–ø–æ—Ä—Ç...`);

                let importedCount = 0;
                let skippedCount = 0;
                const maxSizeMB = getMaxUploadSizeForUser(currentUser);

                for (const [folderName, fileList] of Object.entries(folders)) {
                    const videoFile = fileList.find(f => f.name.toLowerCase().endsWith('.mp4'));
                    const thumbnailFile = fileList.find(f => {
                        const name = f.name.toLowerCase();
                        return name.endsWith('.jpg') || name.endsWith('.jpeg') || 
                               name.endsWith('.png') || name.endsWith('.webp') || 
                               name.endsWith('.gif');
                    });

                    if (!videoFile) {
                        console.warn(`–í –ø–∞–ø–∫–µ "${folderName}" –Ω–µ—Ç –≤–∏–¥–µ–æ .mp4`);
                        skippedCount++;
                        continue;
                    }
                    if (!thumbnailFile) {
                        console.warn(`–í –ø–∞–ø–∫–µ "${folderName}" –Ω–µ—Ç –æ–±–ª–æ–∂–∫–∏`);
                        skippedCount++;
                        continue;
                    }

                    const videoSizeMB = videoFile.size / (1024 * 1024);
                    if (videoSizeMB > maxSizeMB) {
                        alert(`‚ö†Ô∏è –í–∏–¥–µ–æ "${folderName}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ (${videoSizeMB.toFixed(1)} –ú–ë). –ú–∞–∫—Å–∏–º—É–º ${maxSizeMB} –ú–ë. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º.`);
                        skippedCount++;
                        continue;
                    }

                    try {
                        const videoData = await readFileAsDataURL(videoFile);
                        const thumbnailData = await readFileAsDataURL(thumbnailFile);
                        const newVideo = {
                            id: generateId(),
                            title: folderName,
                            authorId: currentUser.id,
                            authorName: currentUser.username,
                            videoData,
                            thumbnailData,
                            likes: [],
                            dislikes: [],
                            views: [],
                            timestamp: new Date().toISOString()
                        };
                        await saveVideoToDB(newVideo);
                        importedCount++;
                        console.log(`‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${folderName}`);
                    } catch (err) {
                        console.error(`–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –ø–∞–ø–∫–∏ "${folderName}":`, err);
                        skippedCount++;
                    }
                }

                await loadVideosCache();
                alert(`‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!\nüì• –î–æ–±–∞–≤–ª–µ–Ω–æ –≤–∏–¥–µ–æ: ${importedCount}\n‚è≠ –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${skippedCount}`);
                renderHome();
            };

            input.click();
        }

        // ---------- 9. –†–ê–ë–û–¢–ê –° YOUTUBE API ----------
        let youtubeSearchResults = [];
        let selectedYoutubeVideoId = null;

        async function searchYouTube(query) {
            if (!youtubeApiKey) {
                alert('‚ùå –ù–µ —É–∫–∞–∑–∞–Ω API –∫–ª—é—á YouTube. –£–∫–∞–∂–∏—Ç–µ –µ–≥–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.');
                return [];
            }

            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=20&q=${encodeURIComponent(query)}&type=video&key=${youtubeApiKey}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (data.error) {
                    console.error('YouTube API error:', data.error);
                    alert(`–û—à–∏–±–∫–∞ YouTube API: ${data.error.message}`);
                    return [];
                }
                return data.items.map(item => ({
                    id: item.id.videoId,
                    title: item.snippet.title,
                    channel: item.snippet.channelTitle,
                    publishedAt: item.snippet.publishedAt,
                    description: item.snippet.description,
                    thumbnail: item.snippet.thumbnails.medium.url
                }));
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ YouTube:', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –∫–ª—é—á API.');
                return [];
            }
        }

        // ---------- 10. –†–ï–ù–î–ï–†–ò–ù–ì –ò–ù–¢–ï–†–§–ï–ô–°–ê ----------
        const app = document.getElementById('app');

        function loadAssets() {
            const bgImg = new Image();
            bgImg.src = './Icons/BackGround.png';
            bgImg.onload = () => {
                document.body.style.backgroundImage = `url('./Icons/BackGround.png')`;
            };
            bgImg.onerror = () => {
                document.body.style.backgroundImage = 'none';
            };
        }

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
        let currentTab = 'new';

        // ---------- –§–£–ù–ö–¶–ò–ò –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ê–í–ê–¢–ê–†–ê ----------
        async function renderAvatarElement(userId, size = 36) {
            const avatar = await getUserAvatar(userId);
            const user = users.find(u => u.id === userId);
            const initial = user ? user.username.charAt(0).toUpperCase() : '?';
            if (avatar) {
                return `<img src="${avatar}" class="avatar" style="width: ${size}px; height: ${size}px;">`;
            } else {
                return `<div class="avatar" style="width: ${size}px; height: ${size}px; background-color: #3ea6ff;">${initial}</div>`;
            }
        }

        // ---------- –ì–õ–ê–í–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê ----------
        window.renderHome = async function() {
            await loadVideosCache();
            const isAdmin = currentUser?.isAdmin || false;
            const isSuperAdmin = currentUser?.isSuperAdmin || false;

            let displayedVideos = [];
            if (currentTab === 'new') {
                displayedVideos = [...videosCache].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            } else if (currentTab === 'popular') {
                displayedVideos = [...videosCache].sort((a, b) => b.views.length - a.views.length).slice(0, 100);
            } else if (currentTab === 'youtube') {
                renderYoutubeTab();
                return;
            }

            let currentUserAvatarHtml = '';
            if (currentUser) {
                currentUserAvatarHtml = await renderAvatarElement(currentUser.id, 36);
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–µ–π–¥–∂ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            let adminBadgeHtml = '';
            if (currentUser) {
                if (currentUser.isSuperAdmin) {
                    adminBadgeHtml = '<span class="super-admin-badge">SUPER ADMIN</span>';
                } else if (currentUser.isAdmin) {
                    adminBadgeHtml = '<span class="admin-badge">ADMIN</span>';
                }
            }

            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        ${!isSuperAdmin ? '<button class="btn btn-warning" onclick="renderOwnerForm()">üëë –í—ã –≤–ª–∞–¥–µ–ª–µ—Ü?</button>' : ''}
                        ${currentUser ? `
                            <div class="user-info">
                                ${currentUserAvatarHtml}
                                <span>${currentUser.username} ${adminBadgeHtml}</span>
                            </div>
                            <button class="btn" onclick="renderUpload()">‚ûï –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                            <button class="btn" onclick="importFromVideoFolder()">üìÅ –ò–º–ø–æ—Ä—Ç –∏–∑ Video</button>
                            <button class="btn" onclick="renderSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                            <button class="btn" onclick="renderChannelSettings()">üì∫ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</button>
                            ${!currentUser.isSuperAdmin ? '<button class="btn" onclick="renderApplicationForm()">üìù –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –∞–¥–º–∏–Ω–∞</button>' : ''}
                            ${isSuperAdmin ? '<button class="btn btn-warning" onclick="renderApplicationsPanel()">üìã –ó–∞—è–≤–∫–∏ –Ω–∞ –∞–¥–º–∏–Ω–∞</button>' : ''}
                            <button class="btn" onclick="logoutHandler()">üö™ –í—ã–π—Ç–∏</button>
                        ` : `
                            <button class="btn btn-primary" onclick="renderLogin()">üîë –í–æ–π—Ç–∏</button>
                            <button class="btn" onclick="renderRegister()">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                        `}
                    </div>
                </div>
                <div class="content">
                    <div class="tabs">
                        <div class="tab ${currentTab === 'new' ? 'active' : ''}" onclick="setTab('new')">üÜï –ù–æ–≤—ã–µ –≤–∏–¥–µ–æ</div>
                        <div class="tab ${currentTab === 'popular' ? 'active' : ''}" onclick="setTab('popular')">üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ (—Ç–æ–ø 100)</div>
                        <div class="tab ${currentTab === 'youtube' ? 'active' : ''}" onclick="setTab('youtube')">üé¨ YouTube –í–∏–¥–µ–æ</div>
                    </div>
                    <div class="grid" id="video-grid">
                        ${displayedVideos.length === 0 ? '<p style="color: #aaa;">–ü–æ–∫–∞ –Ω–µ—Ç –≤–∏–¥–µ–æ. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏–∑ –ø–∞–ø–∫–∏ Video!</p>' : ''}
                        ${displayedVideos.map(video => `
                            <div class="card" data-video-id="${video.id}">
                                <img class="thumbnail" src="${video.thumbnailData}" alt="${video.title}" onclick="renderVideoPage('${video.id}')" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23333%22/><text x=%2230%22 y=%2255%22 fill=%22%23fff%22>–ù–µ—Ç –æ–±–ª–æ–∂–∫–∏</text></svg>'">
                                <div class="video-info" onclick="renderVideoPage('${video.id}')">
                                    <div class="video-title">${escapeHtml(video.title)}</div>
                                    <div class="video-meta">
                                        ${escapeHtml(video.authorName)} ‚Ä¢ 
                                        üëÅ ${video.views.length} ‚Ä¢ 
                                        üëç ${video.likes.length} ‚Ä¢ 
                                        üëé ${video.dislikes.length}
                                    </div>
                                </div>
                                ${(isAdmin || (currentUser && currentUser.id === video.authorId)) ? `
                                    <div class="admin-controls">
                                        <button class="btn btn-small" onclick="editVideoPrompt('${video.id}')">‚úèÔ∏è –†–µ–¥.</button>
                                        <button class="btn btn-danger btn-small" onclick="deleteVideoHandler('${video.id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            app.innerHTML = html;
        };

        // ---------- –§–û–†–ú–ê –ü–û–î–ê–ß–ò –ó–ê–Ø–í–ö–ò –ù–ê –ê–î–ú–ò–ù–ê ----------
        window.renderApplicationForm = function() {
            if (!currentUser) {
                alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏');
                renderLogin();
                return;
            }

            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        <span>üë§ ${currentUser.username}</span>
                        <button class="btn" onclick="logoutHandler()">–í—ã–π—Ç–∏</button>
                    </div>
                </div>
                <div class="form-container">
                    <h2 style="margin-bottom: 20px;">üìù –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –∞–¥–º–∏–Ω–∞</h2>
                    <form onsubmit="applicationSubmitHandler(event)">
                        <div class="form-group">
                            <label>–í–∞—à –Ω–∏–∫ (–±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω)</label>
                            <input type="text" id="app-username" class="form-control" value="${currentUser.username}" readonly required>
                        </div>
                        <div class="form-group">
                            <label>–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç</label>
                            <input type="number" id="app-age" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 16" min="1" max="120" required>
                        </div>
                        <div class="form-group">
                            <label>–ü–æ—á–µ–º—É –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å—Ç–∞—Ç—å –∞–¥–º–∏–Ω–æ–º?</label>
                            <textarea id="app-reason" class="form-control" rows="5" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ –∏ –ø–æ—á–µ–º—É –≤–∞–º –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%;">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                        <button type="button" class="btn" style="width:100%; margin-top:10px;" onclick="renderHome()">–û—Ç–º–µ–Ω–∞</button>
                    </form>
                </div>
            `;
            app.innerHTML = html;
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏
        window.applicationSubmitHandler = async function(e) {
            e.preventDefault();
            const username = document.getElementById('app-username').value.trim();
            const age = document.getElementById('app-age').value.trim();
            const reason = document.getElementById('app-reason').value.trim();

            if (!username || !age || !reason) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–¥–∞–≤–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—è–≤–∫—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º pending
            const existingApplications = await getApplicationsByStatus('pending');
            const alreadyApplied = existingApplications.some(app => app.username === username);
            if (alreadyApplied) {
                alert('‚ùå –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏. –î–æ–∂–¥–∏—Ç–µ—Å—å —Ä–µ—à–µ–Ω–∏—è.');
                renderHome();
                return;
            }

            const application = {
                id: generateId(),
                username,
                age: parseInt(age),
                reason,
                userId: currentUser.id,
                timestamp: new Date().toISOString(),
                status: 'pending' // pending, approved, rejected
            };

            await saveApplicationToDB(application);
            alert('‚úÖ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç –µ—ë.');
            renderHome();
        };

        // ---------- –ü–ê–ù–ï–õ–¨ –ó–ê–Ø–í–û–ö –î–õ–Ø –ì–õ–ê–í–ù–û–ì–û –ê–î–ú–ò–ù–ê ----------
        window.renderApplicationsPanel = async function() {
            if (!currentUser || !currentUser.isSuperAdmin) {
                alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.');
                renderHome();
                return;
            }

            const pendingApplications = await getApplicationsByStatus('pending');
            
            let currentUserAvatarHtml = await renderAvatarElement(currentUser.id, 36);

            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        <div class="user-info">
                            ${currentUserAvatarHtml}
                            <span>${currentUser.username} <span class="super-admin-badge">SUPER ADMIN</span></span>
                        </div>
                        <button class="btn" onclick="renderHome()">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                        <button class="btn" onclick="logoutHandler()">üö™ –í—ã–π—Ç–∏</button>
                    </div>
                </div>
                <div class="content">
                    <h2 style="margin-bottom: 20px;">üìã –ó–∞—è–≤–∫–∏ –Ω–∞ –∞–¥–º–∏–Ω–∞ (${pendingApplications.length})</h2>
                    <div class="applications-container">
                        ${pendingApplications.length === 0 ? '<p style="color: #aaa; text-align: center;">–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫.</p>' : ''}
                        ${pendingApplications.map(app => `
                            <div class="application-card" id="app-${app.id}">
                                <div class="application-header">
                                    <span class="application-user">${escapeHtml(app.username)}</span>
                                    <span class="application-date">${new Date(app.timestamp).toLocaleString()}</span>
                                </div>
                                <div class="application-info">
                                    <p><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> ${app.age}</p>
                                    <p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong></p>
                                    <div class="application-reason">${escapeHtml(app.reason)}</div>
                                </div>
                                <div class="application-actions">
                                    <button class="btn btn-success" onclick="approveApplication('${app.id}')">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</button>
                                    <button class="btn btn-danger" onclick="rejectApplication('${app.id}')">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            app.innerHTML = html;
        };

        // –û–¥–æ–±—Ä–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
        window.approveApplication = async function(applicationId) {
            if (!currentUser || !currentUser.isSuperAdmin) return;
            
            const application = await getApplicationById(applicationId);
            if (!application) return;

            // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = users.find(u => u.id === application.userId);
            if (user) {
                // –î–µ–ª–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–¥–º–∏–Ω–æ–º (–Ω–æ –Ω–µ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–æ–º)
                user.isAdmin = true;
                // –ù–µ –º–µ–Ω—è–µ–º isSuperAdmin ‚Äì —ç—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è Youtube-Dregot
                saveUsers();

                // –ï—Å–ª–∏ —ç—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äì –æ–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é
                if (currentUser && currentUser.id === user.id) {
                    currentUser.isAdmin = true;
                    saveCurrentUser();
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏
                await updateApplicationStatus(applicationId, 'approved');
                alert(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${user.username} —Ç–µ–ø–µ—Ä—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!`);
            } else {
                alert('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω —É–¥–∞–ª–∏–ª –∞–∫–∫–∞—É–Ω—Ç.');
                await updateApplicationStatus(applicationId, 'rejected');
            }

            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–∞–Ω–µ–ª—å –∑–∞—è–≤–æ–∫
            renderApplicationsPanel();
        };

        // –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
        window.rejectApplication = async function(applicationId) {
            if (!currentUser || !currentUser.isSuperAdmin) return;
            
            await updateApplicationStatus(applicationId, 'rejected');
            alert('‚ùå –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞.');
            renderApplicationsPanel();
        };

        // ---------- –û–¢–î–ï–õ–¨–ù–´–ô –†–ï–ù–î–ï–†–ò–ù–ì –í–ö–õ–ê–î–ö–ò YOUTUBE ----------
        async function renderYoutubeTab() {
            const isSuperAdmin = currentUser?.isSuperAdmin || false;
            let currentUserAvatarHtml = '';
            let adminBadgeHtml = '';
            
            if (currentUser) {
                currentUserAvatarHtml = await renderAvatarElement(currentUser.id, 36);
                if (currentUser.isSuperAdmin) {
                    adminBadgeHtml = '<span class="super-admin-badge">SUPER ADMIN</span>';
                } else if (currentUser.isAdmin) {
                    adminBadgeHtml = '<span class="admin-badge">ADMIN</span>';
                }
            }

            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        ${!isSuperAdmin ? '<button class="btn btn-warning" onclick="renderOwnerForm()">üëë –í—ã –≤–ª–∞–¥–µ–ª–µ—Ü?</button>' : ''}
                        ${currentUser ? `
                            <div class="user-info">
                                ${currentUserAvatarHtml}
                                <span>${currentUser.username} ${adminBadgeHtml}</span>
                            </div>
                            <button class="btn" onclick="renderUpload()">‚ûï –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                            <button class="btn" onclick="importFromVideoFolder()">üìÅ –ò–º–ø–æ—Ä—Ç –∏–∑ Video</button>
                            <button class="btn" onclick="renderSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                            <button class="btn" onclick="renderChannelSettings()">üì∫ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</button>
                            ${!currentUser.isSuperAdmin ? '<button class="btn" onclick="renderApplicationForm()">üìù –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –∞–¥–º–∏–Ω–∞</button>' : ''}
                            ${isSuperAdmin ? '<button class="btn btn-warning" onclick="renderApplicationsPanel()">üìã –ó–∞—è–≤–∫–∏ –Ω–∞ –∞–¥–º–∏–Ω–∞</button>' : ''}
                            <button class="btn" onclick="logoutHandler()">üö™ –í—ã–π—Ç–∏</button>
                        ` : `
                            <button class="btn btn-primary" onclick="renderLogin()">üîë –í–æ–π—Ç–∏</button>
                            <button class="btn" onclick="renderRegister()">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                        `}
                    </div>
                </div>
                <div class="content">
                    <div class="tabs">
                        <div class="tab" onclick="setTab('new')">üÜï –ù–æ–≤—ã–µ –≤–∏–¥–µ–æ</div>
                        <div class="tab" onclick="setTab('popular')">üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ (—Ç–æ–ø 100)</div>
                        <div class="tab active" onclick="setTab('youtube')">üé¨ YouTube –í–∏–¥–µ–æ</div>
                    </div>

                    <div class="youtube-search">
                        <h2 style="margin-bottom: 20px;">üîç –ü–æ–∏—Å–∫ –Ω–∞ YouTube</h2>
                        <form onsubmit="youtubeSearchHandler(event)">
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="youtube-query" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..." required style="flex: 1;">
                                <button type="submit" class="btn btn-primary">–ò—Å–∫–∞—Ç—å</button>
                            </div>
                        </form>
                    </div>

                    ${selectedYoutubeVideoId ? `
                        <div class="youtube-player">
                            <iframe src="https://www.youtube.com/embed/${selectedYoutubeVideoId}" allowfullscreen></iframe>
                        </div>
                    ` : ''}

                    <div class="grid" id="youtube-results-grid">
                        ${youtubeSearchResults.length === 0 ? '<p style="color: #aaa;">–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤–∏–¥–µ–æ –Ω–∞ YouTube.</p>' : ''}
                        ${youtubeSearchResults.map(video => `
                            <div class="card" onclick="selectYoutubeVideo('${video.id}')">
                                <img class="thumbnail" src="${video.thumbnail}" alt="${video.title}">
                                <div class="video-info">
                                    <div class="video-title">${escapeHtml(video.title)}</div>
                                    <div class="video-meta">
                                        ${escapeHtml(video.channel)} ‚Ä¢ 
                                        ${new Date(video.publishedAt).toLocaleDateString()}
                                    </div>
                                    <div class="video-meta" style="margin-top: 5px; color: #777;">
                                        ${escapeHtml(video.description.substring(0, 80))}...
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            app.innerHTML = html;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∏—Å–∫–∞ YouTube
        window.youtubeSearchHandler = async function(e) {
            e.preventDefault();
            const query = document.getElementById('youtube-query').value.trim();
            if (!query) return;
            youtubeSearchResults = await searchYouTube(query);
            selectedYoutubeVideoId = null;
            setTab('youtube');
        };

        // –í—ã–±–æ—Ä –≤–∏–¥–µ–æ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
        window.selectYoutubeVideo = function(videoId) {
            selectedYoutubeVideoId = videoId;
            setTab('youtube');
        };

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        window.setTab = function(tab) {
            currentTab = tab;
            renderHome();
        };

        // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ
        window.editVideoPrompt = async function(videoId) {
            const video = getVideoById(videoId);
            if (!video) return;
            const newTitle = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ:', video.title);
            if (newTitle && newTitle.trim() !== '') {
                await updateVideoTitle(videoId, newTitle.trim());
                renderHome();
            }
        };

        // –£–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ
        window.deleteVideoHandler = async function(videoId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ?')) {
                await deleteVideo(videoId);
                renderHome();
            }
        };

        // ---------- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ----------
        window.renderRegister = function() {
            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        <button class="btn btn-warning" onclick="renderOwnerForm()">üëë –í—ã –≤–ª–∞–¥–µ–ª–µ—Ü?</button>
                    </div>
                </div>
                <div class="form-container">
                    <h2 style="margin-bottom: 20px;">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                    <form onsubmit="registerHandler(event)">
                        <div class="form-group">
                            <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                            <input type="text" id="reg-username" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="reg-password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                        <button type="button" class="btn" style="width:100%; margin-top:10px;" onclick="renderHome()">–û—Ç–º–µ–Ω–∞</button>
                    </form>
                </div>
            `;
            app.innerHTML = html;
        };

        window.registerHandler = function(e) {
            e.preventDefault();
            const username = document.getElementById('reg-username').value.trim();
            const password = document.getElementById('reg-password').value.trim();
            if (!username || !password) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            const result = registerUser(username, password);
            if (result.success) {
                if (username === 'Youtube-Dregot') {
                    alert('üëë –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ì–ª–∞–≤–Ω—ã–π –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä! –§–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω.');
                } else {
                    alert('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
                }
                renderLogin();
            } else {
                alert(result.error);
            }
        };

        // ---------- –í–•–û–î ----------
        window.renderLogin = function() {
            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        <button class="btn btn-warning" onclick="renderOwnerForm()">üëë –í—ã –≤–ª–∞–¥–µ–ª–µ—Ü?</button>
                    </div>
                </div>
                <div class="form-container">
                    <h2 style="margin-bottom: 20px;">üîë –í—Ö–æ–¥</h2>
                    <form onsubmit="loginHandler(event)">
                        <div class="form-group">
                            <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                            <input type="text" id="login-username" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="login-password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%;">–í–æ–π—Ç–∏</button>
                        <button type="button" class="btn" style="width:100%; margin-top:10px;" onclick="renderHome()">–û—Ç–º–µ–Ω–∞</button>
                    </form>
                </div>
            `;
            app.innerHTML = html;
        };

        window.loginHandler = function(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const result = loginUser(username, password);
            if (result.success) {
                renderHome();
            } else {
                alert(result.error);
            }
        };

        window.logoutHandler = function() {
            logout();
        };

        // ---------- –ó–ê–ì–†–£–ó–ö–ê –í–ò–î–ï–û ----------
        window.renderUpload = function() {
            if (!currentUser) {
                alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏');
                renderLogin();
                return;
            }
            const maxSizeMB = getMaxUploadSizeForUser(currentUser);
            let maxSizeText = '';
            if (currentUser.isAdmin) {
                maxSizeText = `–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: 20 –ì–ë (${maxSizeMB} –ú–ë)`;
            } else {
                const ageDays = getAccountAgeInDays(currentUser);
                maxSizeText = ageDays < 7 ? '1 –ì–ë (–¥–æ 7 –¥–Ω–µ–π)' : '10 –ì–ë (–±–æ–ª–µ–µ 7 –¥–Ω–µ–π)';
            }

            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        <button class="btn btn-warning" onclick="renderOwnerForm()">üëë –í—ã –≤–ª–∞–¥–µ–ª–µ—Ü?</button>
                        <span>üë§ ${currentUser.username}</span>
                        <button class="btn" onclick="logoutHandler()">–í—ã–π—Ç–∏</button>
                    </div>
                </div>
                <div class="form-container">
                    <h2 style="margin-bottom: 20px;">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</h2>
                    <p style="color: #ffb300; margin-bottom: 15px;">
                        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞: <strong>${maxSizeMB} –ú–ë</strong> (${maxSizeText})
                    </p>
                    <form onsubmit="uploadHandler(event)">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ</label>
                            <input type="text" id="video-title" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>–í–∏–¥–µ–æ (mp4)</label>
                            <input type="file" id="video-file" accept="video/mp4" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>–û–±–ª–æ–∂–∫–∞ (png, jpg)</label>
                            <input type="file" id="thumbnail-file" accept="image/png, image/jpeg" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%;">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                        <button type="button" class="btn" style="width:100%; margin-top:10px;" onclick="renderHome()">–û—Ç–º–µ–Ω–∞</button>
                    </form>
                </div>
            `;
            app.innerHTML = html;
        };

        window.uploadHandler = async function(e) {
            e.preventDefault();
            const title = document.getElementById('video-title').value.trim();
            const videoFile = document.getElementById('video-file').files[0];
            const thumbFile = document.getElementById('thumbnail-file').files[0];
            if (!title || !videoFile || !thumbFile) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            const result = await addVideo(title, videoFile, thumbFile);
            if (result) {
                alert('‚úÖ –í–∏–¥–µ–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!');
                renderHome();
            }
        };

        // ---------- –°–¢–†–ê–ù–ò–¶–ê –í–ò–î–ï–û ----------
        window.renderVideoPage = async function(videoId) {
            const video = await getVideoFromDB(videoId);
            if (!video) {
                alert('–í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                renderHome();
                return;
            }

            await addView(videoId, currentUser?.id || null);
            await loadVideosCache();
            const updatedVideo = getVideoById(videoId);

            const isLiked = currentUser ? updatedVideo.likes.includes(currentUser.id) : false;
            const isDisliked = currentUser ? updatedVideo.dislikes.includes(currentUser.id) : false;
            const isSubscribedToAuthor = currentUser ? isSubscribed(updatedVideo.authorId, currentUser.id) : false;
            const isAdmin = currentUser?.isAdmin || false;
            const isSuperAdmin = currentUser?.isSuperAdmin || false;
            const canEdit = isAdmin || (currentUser && currentUser.id === updatedVideo.authorId);

            const comments = await getCommentsByVideo(videoId);

            const authorAvatar = await renderAvatarElement(updatedVideo.authorId, 36);
            let currentUserAvatarHtml = '';
            let adminBadgeHtml = '';
            if (currentUser) {
                currentUserAvatarHtml = await renderAvatarElement(currentUser.id, 36);
                if (currentUser.isSuperAdmin) {
                    adminBadgeHtml = '<span class="super-admin-badge">SUPER ADMIN</span>';
                } else if (currentUser.isAdmin) {
                    adminBadgeHtml = '<span class="admin-badge">ADMIN</span>';
                }
            }

            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        ${!isSuperAdmin ? '<button class="btn btn-warning" onclick="renderOwnerForm()">üëë –í—ã –≤–ª–∞–¥–µ–ª–µ—Ü?</button>' : ''}
                        ${currentUser ? `
                            <div class="user-info">
                                ${currentUserAvatarHtml}
                                <span>${currentUser.username} ${adminBadgeHtml}</span>
                            </div>
                            <button class="btn" onclick="renderUpload()">‚ûï –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                            <button class="btn" onclick="renderChannelSettings()">üì∫ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</button>
                            ${!currentUser.isSuperAdmin ? '<button class="btn" onclick="renderApplicationForm()">üìù –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –∞–¥–º–∏–Ω–∞</button>' : ''}
                            ${isSuperAdmin ? '<button class="btn btn-warning" onclick="renderApplicationsPanel()">üìã –ó–∞—è–≤–∫–∏ –Ω–∞ –∞–¥–º–∏–Ω–∞</button>' : ''}
                            <button class="btn" onclick="logoutHandler()">üö™ –í—ã–π—Ç–∏</button>
                        ` : `
                            <button class="btn btn-primary" onclick="renderLogin()">üîë –í–æ–π—Ç–∏</button>
                            <button class="btn" onclick="renderRegister()">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                        `}
                    </div>
                </div>
                <div class="video-player-container">
                    <video src="${updatedVideo.videoData}" controls></video>
                    <div class="video-details">
                        <h1>${escapeHtml(updatedVideo.title)} ${canEdit ? '<button class="btn btn-small" onclick="editVideoPrompt(\'' + updatedVideo.id + '\')">‚úèÔ∏è</button>' : ''}</h1>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                ${authorAvatar}
                                <span style="color: #3ea6ff;">${escapeHtml(updatedVideo.authorName)}</span> ‚Ä¢ 
                                üëÅ ${updatedVideo.views.length} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
                            </div>
                            <div class="video-actions">
                                <div class="like-btn ${isLiked ? 'active' : ''}" onclick="likeHandler('${updatedVideo.id}')">
                                    üëç ${updatedVideo.likes.length} –õ–∞–π–∫
                                </div>
                                <div class="dislike-btn ${isDisliked ? 'active' : ''}" onclick="dislikeHandler('${updatedVideo.id}')">
                                    üëé ${updatedVideo.dislikes.length} –î–∏–∑–ª–∞–π–∫
                                </div>
                                ${currentUser && updatedVideo.authorId !== currentUser.id ? `
                                    <button class="subscribe-btn ${isSubscribedToAuthor ? 'subscribed' : ''}" onclick="subscribeHandler('${updatedVideo.authorId}', '${updatedVideo.id}')">
                                        ${isSubscribedToAuthor ? '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è' : '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è'}
                                    </button>
                                ` : ''}
                                ${canEdit ? `
                                    <button class="btn btn-danger" onclick="deleteVideoHandler('${updatedVideo.id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ</button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò -->
                <div class="comments-section">
                    <h3 style="margin-bottom: 20px;">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (${comments.length})</h3>
                    
                    ${currentUser ? `
                        <form onsubmit="commentHandler(event, '${updatedVideo.id}')" style="margin-bottom: 30px;">
                            <div class="form-group">
                                <textarea id="comment-text" class="form-control" rows="3" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                        </form>
                    ` : `
                        <p style="color: #aaa; margin-bottom: 20px;">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
                    `}

                    <div class="comments-list">
                        ${comments.length === 0 ? '<p style="color: #aaa;">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>' : ''}
                        ${comments.map(comment => `
                            <div class="comment" id="comment-${comment.id}">
                                <div class="comment-header">
                                    <span class="comment-author">${escapeHtml(comment.authorName)}</span>
                                    <span class="comment-date">${new Date(comment.timestamp).toLocaleString()}</span>
                                </div>
                                <div class="comment-text">${escapeHtml(comment.text)}</div>
                                <div class="comment-actions">
                                    ${(currentUser && (currentUser.id === comment.authorId || currentUser.isAdmin)) ? `
                                        <button class="btn btn-danger btn-small" onclick="deleteCommentHandler('${comment.id}', '${updatedVideo.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="margin-top: 40px;">
                    <h3>–î—Ä—É–≥–∏–µ –≤–∏–¥–µ–æ –∞–≤—Ç–æ—Ä–∞</h3>
                    <div class="grid" style="margin-top: 20px;">
                        ${videosCache.filter(v => v.authorId === updatedVideo.authorId && v.id !== updatedVideo.id).slice(0, 4).map(v => `
                            <div class="card" onclick="renderVideoPage('${v.id}')">
                                <img class="thumbnail" src="${v.thumbnailData}" alt="${v.title}">
                                <div class="video-info">
                                    <div class="video-title">${escapeHtml(v.title)}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            app.innerHTML = html;
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        window.commentHandler = async function(e, videoId) {
            e.preventDefault();
            const text = document.getElementById('comment-text').value.trim();
            if (!text) return;
            await addComment(videoId, text);
            renderVideoPage(videoId);
        };

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        window.deleteCommentHandler = async function(commentId, videoId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?')) {
                const success = await deleteComment(commentId, currentUser?.id, currentUser?.isAdmin || false);
                if (success) {
                    renderVideoPage(videoId);
                } else {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è.');
                }
            }
        };

        // ---------- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –õ–ê–ô–ö–û–í, –î–ò–ó–õ–ê–ô–ö–û–í, –ü–û–î–ü–ò–°–û–ö ----------
        window.likeHandler = async function(videoId) {
            if (!currentUser) {
                alert('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫');
                renderLogin();
                return;
            }
            await toggleLike(videoId, currentUser.id);
            renderVideoPage(videoId);
        };

        window.dislikeHandler = async function(videoId) {
            if (!currentUser) {
                alert('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –¥–∏–∑–ª–∞–π–∫');
                renderLogin();
                return;
            }
            await toggleDislike(videoId, currentUser.id);
            renderVideoPage(videoId);
        };

        window.subscribeHandler = function(authorId, videoId) {
            if (!currentUser) {
                alert('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è');
                renderLogin();
                return;
            }
            toggleSubscription(authorId, currentUser.id);
            renderVideoPage(videoId);
        };

        // ---------- –ù–ê–°–¢–†–û–ô–ö–ò (–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –§–û–ù–ï –ò API –ö–õ–Æ–ß) ----------
        window.renderSettings = function() {
            let isSuperAdmin = currentUser?.isSuperAdmin || false;
            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        ${!isSuperAdmin ? '<button class="btn btn-warning" onclick="renderOwnerForm()">üëë –í—ã –≤–ª–∞–¥–µ–ª–µ—Ü?</button>' : ''}
                        ${currentUser ? `
                            <span>üë§ ${currentUser.username}</span>
                            <button class="btn" onclick="logoutHandler()">üö™ –í—ã–π—Ç–∏</button>
                        ` : `
                            <button class="btn btn-primary" onclick="renderLogin()">üîë –í–æ–π—Ç–∏</button>
                        `}
                    </div>
                </div>
                <div class="form-container" style="max-width: 600px;">
                    <h2 style="margin-bottom: 20px;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                    
                    <div style="background-color: #2a2a2a; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: #ffb300;">üñºÔ∏è –°–º–µ–Ω–∞ —Ñ–æ–Ω–∞</h3>
                        <p style="color: #ddd; margin-bottom: 15px;">
                            –•–æ—Ç–∏—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å –∑–∞–¥–Ω–∏–π —Ñ–æ–Ω?<br>
                            1. –ó–∞–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É <strong>Youtube 2.0</strong>.<br>
                            2. –í–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ <strong>Icons</strong> –ø–æ–ª–æ–∂–∏—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫—É —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º <strong>BackGround.png</strong> (–∏–ª–∏ .jpg).<br>
                            3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Äî —Ñ–æ–Ω –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                        </p>
                        <p style="color: #aaa; font-size: 0.9rem;">
                            –¢–µ–∫—É—â–∏–π —Ñ–æ–Ω: ${document.body.style.backgroundImage ? '—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' : '–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é'}
                        </p>
                    </div>

                    <div style="background-color: #2a2a2a; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: #ffb300;">üîë YouTube API –∫–ª—é—á</h3>
                        <p style="color: #ddd; margin-bottom: 15px;">
                            –î–ª—è –ø–æ–∏—Å–∫–∞ –≤–∏–¥–µ–æ –Ω–∞ YouTube —Ç—Ä–µ–±—É–µ—Ç—Å—è API –∫–ª—é—á. –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –¥–µ–º–æ-–∫–ª—é—á –∏–ª–∏ –≤–≤–µ—Å—Ç–∏ —Å–≤–æ–π.
                        </p>
                        <form onsubmit="saveApiKeyHandler(event)">
                            <div class="form-group">
                                <label>API –∫–ª—é—á</label>
                                <input type="text" id="api-key" class="form-control" value="${youtubeApiKey}" required>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width:100%;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á</button>
                        </form>
                    </div>

                    <button class="btn" onclick="renderHome()" style="width:100%;">üîô –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                </div>
            `;
            app.innerHTML = html;
        };

        window.saveApiKeyHandler = function(e) {
            e.preventDefault();
            const newKey = document.getElementById('api-key').value.trim();
            if (newKey) {
                saveYoutubeApiKey(newKey);
                alert('‚úÖ API –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
                renderSettings();
            }
        };

        // ---------- –ù–ê–°–¢–†–û–ô–ö–ò –ö–ê–ù–ê–õ–ê ----------
        window.renderChannelSettings = async function() {
            if (!currentUser) {
                alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏');
                renderLogin();
                return;
            }

            const stats = await getChannelStats(currentUser.id);
            const currentAvatar = await getUserAvatar(currentUser.id);
            const initial = currentUser.username.charAt(0).toUpperCase();

            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        <button class="btn btn-warning" onclick="renderOwnerForm()">üëë –í—ã –≤–ª–∞–¥–µ–ª–µ—Ü?</button>
                        <span>üë§ ${currentUser.username}</span>
                        <button class="btn" onclick="logoutHandler()">üö™ –í—ã–π—Ç–∏</button>
                    </div>
                </div>
                <div class="form-container" style="max-width: 600px;">
                    <h2 style="margin-bottom: 20px;">üì∫ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</h2>
                    
                    <!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ -->
                    <div class="avatar-upload">
                        <h3 style="margin-bottom: 10px;">–ê–≤–∞—Ç–∞—Ä–∫–∞</h3>
                        <div id="avatar-preview" class="avatar-preview" style="background-image: ${currentAvatar ? `url('${currentAvatar}')` : 'none'}; background-size: cover; background-position: center;">
                            ${!currentAvatar ? initial : ''}
                        </div>
                        <form onsubmit="uploadAvatarHandler(event)">
                            <div class="form-group">
                                <label>–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                                <input type="file" id="avatar-file" accept="image/png, image/jpeg, image/jpg, image/webp" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width:100%;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</button>
                        </form>
                        ${currentAvatar ? `
                            <button class="btn btn-danger" onclick="deleteAvatarHandler()" style="margin-top: 10px;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</button>
                        ` : ''}
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="channel-stats">
                        <h3 style="margin-bottom: 20px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–Ω–∞–ª–∞</h3>
                        <div class="stat-item">
                            <span class="stat-label">üë• –ü–æ–¥–ø–∏—Å—á–∏–∫–∏</span>
                            <span class="stat-value">${stats.subscribers}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">üé¨ –í—Å–µ–≥–æ –≤–∏–¥–µ–æ</span>
                            <span class="stat-value">${stats.videosCount}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">üëÅ –°—É–º–º–∞—Ä–Ω—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã</span>
                            <span class="stat-value">${stats.totalViews}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">üëç –í—Å–µ–≥–æ –ª–∞–π–∫–æ–≤</span>
                            <span class="stat-value">${stats.totalLikes}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">üëé –í—Å–µ–≥–æ –¥–∏–∑–ª–∞–π–∫–æ–≤</span>
                            <span class="stat-value">${stats.totalDislikes}</span>
                        </div>
                    </div>

                    <button class="btn" onclick="renderHome()" style="width:100%;">üîô –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                </div>
            `;
            app.innerHTML = html;
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏
        window.uploadAvatarHandler = async function(e) {
            e.preventDefault();
            const file = document.getElementById('avatar-file').files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                alert('‚ùå –ê–≤–∞—Ç–∞—Ä–∫–∞ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è. –ú–∞–∫—Å–∏–º—É–º 5 –ú–ë.');
                return;
            }

            try {
                const avatarData = await readFileAsDataURL(file);
                await setUserAvatar(currentUser.id, avatarData);
                alert('‚úÖ –ê–≤–∞—Ç–∞—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
                renderChannelSettings();
            } catch (err) {
                console.error(err);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∫–∏.');
            }
        };

        // –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏
        window.deleteAvatarHandler = async function() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É?')) {
                await deleteAvatarFromDB(currentUser.id);
                avatarCache.delete(currentUser.id);
                alert('‚úÖ –ê–≤–∞—Ç–∞—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∞.');
                renderChannelSettings();
            }
        };

        // ---------- –§–û–†–ú–ê –í–õ–ê–î–ï–õ–¨–¶–ê (–ù–ï –†–ê–ë–û–¢–ê–ï–¢ –î–õ–Ø –°–£–ü–ï–†-–ê–î–ú–ò–ù–ê) ----------
        window.renderOwnerForm = function() {
            if (currentUser?.isSuperAdmin) {
                alert('üëë –í—ã –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞.');
                renderHome();
                return;
            }

            let html = `
                <div class="header">
                    <div class="logo" onclick="renderHome()">
                        <img src="./Icons/Logo.png" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2210%22 y=%2265%22 font-size=%2250%22 fill=%22%23ff0000%22>üé¨</text></svg>';">
                        <span>YouTube 2.0</span>
                    </div>
                    <div class="user-section">
                        <button class="btn btn-warning" onclick="renderOwnerForm()">üëë –í—ã –≤–ª–∞–¥–µ–ª–µ—Ü?</button>
                    </div>
                </div>
                <div class="form-container">
                    <h2 style="margin-bottom: 20px;">üëë –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞</h2>
                    <form onsubmit="ownerCheckHandler(event)">
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (–î–î.–ú–ú.–ì–ì–ì–ì)</label>
                            <input type="text" id="owner-birth" class="form-control" placeholder="02.02.2017" required>
                        </div>
                        <div class="form-group">
                            <label>–ü–∞—Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞</label>
                            <input type="password" id="owner-password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-warning" style="width:100%;">üîë –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                        <button type="button" class="btn" style="width:100%; margin-top:10px;" onclick="renderHome()">–û—Ç–º–µ–Ω–∞</button>
                    </form>
                </div>
            `;
            app.innerHTML = html;
        };

        window.ownerCheckHandler = function(e) {
            e.preventDefault();
            const birth = document.getElementById('owner-birth').value.trim();
            const pass = document.getElementById('owner-password').value.trim();

            if (verifyOwner(birth, pass)) {
                if (!currentUser) {
                    alert('‚úÖ –î–∞–Ω–Ω—ã–µ –≤–µ—Ä–Ω—ã, –Ω–æ –≤—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, –∑–∞—Ç–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É.');
                    renderLogin();
                    return;
                }
                
                // –ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω—ë–Ω
                if (currentUser.isSuperAdmin) {
                    alert('üëë –í—ã –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –≤–∞—à —Å—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–º–µ–Ω—è–µ–º.');
                    renderHome();
                    return;
                }

                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].isAdmin = true;
                    currentUser.isAdmin = true;
                    saveUsers();
                    saveCurrentUser();
                    alert('üëë –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
                    renderHome();
                } else {
                    alert('–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.');
                }
            } else {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å.');
            }
        };

        // ---------- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ----------
        async function initApp() {
            await openDB();
            await loadVideosCache();
            loadAssets();
            renderHome();
        }

        initApp();

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.importFromVideoFolder = importFromVideoFolder;
        window.logout = logout;
    </script>
</body>
</html>